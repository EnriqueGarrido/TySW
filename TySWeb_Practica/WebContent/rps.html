<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Rock-Paper-Scissors - TCG</title>
<link href="css/rps.css" rel="stylesheet">
</head>
<body>
	<div class="rps-game">
		<div>
			<h1 align="center" class="game-tittle">ROCK, PAPER, SCISSORS</h1>
		</div>
		<div class="rps_board">
			<div class="rps_state">
				<p id="Information"></p>
				<div class="rps_score">
					<button onclick="LeaveGame()">Leave Game</button>
					<p id=Information></p>
					<div class="score">
						<p id="name_opponent"></p>
						<p id="score_opponent" class="score_display">0</p>
					</div>
					<div class="score">
						<p id="name_player"></p>
						<p id="score_player" class="score_display">0</p>
					</div>
				</div>
				<div class="rps_move">
					<div class="player_move">
						<p class="move_election">Waiting movement</p>
					</div>
					<p class="versus">VS</p>
					<div class="player_move">
						<p class="move_election">Waiting movement</p>
					</div>
					<div class="rps_options">
						<img id="Paper" src="img/Paper.png"> 
						<img id="Rock" src="img/rock.png"> 
						<img id="Scissors" src="img/Scissors.png">
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<script>
	var gamews = {};
	
	window.onload = function(){
		createWebsocket();
	}
	
	function createWebsocket(){
		var url = "ws://" + window.location.hostname + ":" + window.location.port + "/TySWeb_Practica/ws_games";
		gamews = new WebSocket(url);
		
		gamews.onopen = function(){
			beginMatch();
		}
		
		gamews.onerror = function(){}
		
		gamews.onclose = function(){}
		
		gamews.onmessage = function(m){
			var data = m.data;
			data = JSON.parse(data);
			var information = document.getElementById("Information");
			var name_opponent = document.getElementById("name_opponent");
			var name_player = document.getElementById("name_player");
			
			if(data.TYPE == "MATCH"){
				if(data.players != null){
					information.innerHTML= "PARTIDA COMENZADA";
					name_player.innerHTML=sessionStorage.name;
					
					for (var i in data.players){
						if ((sessionStorage.name)!=(data.players[i].userName)){
							name_opponent.innerHTML= data.players[i].userName;
						}
					}	
				}
			}else if(data.TYPE == "INFORMATIVE"){
					information.innerHTML= data.text;
					name_player.innerHTML=sessionStorage.name;
					name_opponent.innerHTML= "...";
			}
		}
	}
	
	window.onbeforeunload = function(){
		gamews.close();
	}
	
	function beginMatch(){
		var begin = {TYPE: "BEGIN_MATCH"}
		gamews.send(JSON.stringify(begin));
	}
	
	function LeaveGame(){
		gamews.close();
		location.href="GameSelection.html";	
	}
	
	
	
	
	
	
	</script>

</body>
</html>