<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Find Pair of Letters - TCG</title>
<link href="css/FindLetters.css" rel="stylesheet">
</head>
<body>
		<div>
			<h1 align="center" class="game-tittle">FIND PAIR OF LETTERS</h1>
		</div>
		<div class="FL_game">
			<p id="Information"></p>
			<div class="FL_State">
				<div class="FL_score">
					<button onclick="LeaveGame()">Leave Game</button>
					<p>Score</p>
					<div class="score">
						<p id="name_opponent"></p>
						<p id="score_opponent" class="score_display">0</p>
					</div>
					<div class="score">
						<p id="name_player"></p>
						<p id="score_player" class="score_display">0</p>
					</div>
				</div>
				<div class="FL_choose">
					<div class="FL_choose">
						<div onclick=onClickedBox(this.id) id="0" class="letter">
							<p id="option_letter0" class="letter_display"></p>
						</div>
						<div onclick=onClickedBox(this.id) id="1" class="letter">
							<p id="option_letter1" class="letter_display"></p>
						</div>
						<div onclick=onClickedBox(this.id) id="2" class="letter">
							<p id="option_letter2" class="letter_display"></p>
						</div>
						<div onclick=onClickedBox(this.id) id="3" class="letter">
							<p id="option_letter3" class="letter_display"></p>
						</div>
						<div onclick=onClickedBox(this.id) id="4" class="letter">
							<p id="option_letter4" class="letter_display"></p>
						</div>
						<div onclick=onClickedBox(this.id) id="5" class="letter">
							<p id="option_letter5" class="letter_display"></p>
						</div>
						<div onclick=onClickedBox(this.id) id="6" class="letter">
							<p id="option_letter6" class="letter_display"></p>
						</div>
						<div onclick=onClickedBox(this.id) id="7" class="letter">
							<p id="option_letter7" class="letter_display"></p>
						</div>
						<div onclick=onClickedBox(this.id) id="8" class="letter">
							<p id="option_letter8" class="letter_display"></p>
						</div>
						<div onclick=onClickedBox(this.id) id="9" class="letter">
							<p id="option_letter9" class="letter_display"></p>
						</div>
				</div>
				<div class="FL_choose">
					<div onclick=onClickedBox(this.id) id="10" class="letter">
						<p id="option_letter10" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="11" class="letter">
						<p id="option_letter11" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="12" class="letter">
						<p id="option_letter12" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="13" class="letter">
						<p id="option_letter13" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="14" class="letter">
						<p id="option_letter14" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="15" class="letter">
						<p id="option_letter15" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="16" class="letter">
						<p id="option_letter16" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="17" class="letter">
						<p id="option_letter17" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="18" class="letter">
						<p id="option_letter18" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="19" class="letter">
						<p id="option_letter19" class="letter_display"></p>
					</div>
				</div>
				<div class="FL_choose">
					<div onclick=onClickedBox(this.id) id="20" class="letter">
						<p id="option_letter20" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="21" class="letter">
						<p id="option_letter21" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="22" class="letter">
						<p id="option_letter22" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="23" class="letter">
						<p id="option_letter23" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="24" class="letter">
						<p id="option_letter24" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="25" class="letter">
						<p id="option_letter25" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="26" class="letter">
						<p id="option_letter26" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="27" class="letter">
						<p id="option_letter27" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="28" class="letter">
						<p id="option_letter28" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="29" class="letter">
						<p id="option_letter29" class="letter_display"></p>
					</div>
				</div>
				<div class="FL_choose">
					<div onclick=onClickedBox(this.id) id="30" class="letter">
						<p id="option_letter30" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="31" class="letter">
						<p id="option_letter31" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="32" class="letter">
						<p id="option_letter32" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="33" class="letter">
						<p id="option_letter33" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="34" class="letter">
						<p id="option_letter34" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="35" class="letter">
						<p id="option_letter35" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="36" class="letter">
						<p id="option_letter36" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="37" class="letter">
						<p id="option_letter37" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="38" class="letter">
						<p id="option_letter38" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="39" class="letter">
						<p id="option_letter39" class="letter_display"></p>
					</div>
				</div>
				<div class="FL_choose">
					<div onclick=onClickedBox(this.id) id="40" class="letter">
						<p id="option_letter40" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="41" class="letter">
						<p id="option_letter41" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="42" class="letter">
						<p id="option_letter42" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="43" class="letter">
						<p id="option_letter43" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="44" class="letter">
						<p id="option_letter44" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="45" class="letter">
						<p id="option_letter45" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="46" class="letter">
						<p id="option_letter46" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="47" class="letter">
						<p id="option_letter47" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="48" class="letter">
						<p id="option_letter48" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="49" class="letter">
						<p id="option_letter49" class="letter_display"></p>
					</div>
				</div>
				<div class="FL_choose">
					<div onclick=onClickedBox(this.id) id="50" class="letter">
						<p id="option_letter50" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="51" class="letter">
						<p id="option_letter51" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="52" class="letter">
						<p id="option_letter52" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="53" class="letter">
						<p id="option_letter53" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="54" class="letter">
						<p id="option_letter54" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="55" class="letter">
						<p id="option_letter55" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="56" class="letter">
						<p id="option_letter56" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="57" class="letter">
						<p id="option_letter57" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="58" class="letter">
						<p id="option_letter58" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="59" class="letter">
						<p id="option_letter59" class="letter_display"></p>
					</div>
				</div>
				<div class="FL_choose">
					<div onclick=onClickedBox(this.id) id="60" class="letter">
						<p id="option_letter60" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="61" class="letter">
						<p id="option_letter61" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="62" class="letter">
						<p id="option_letter62" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="63" class="letter">
						<p id="option_letter63" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="64" class="letter">
						<p id="option_letter64" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="65" class="letter">
						<p id="option_letter65" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="66" class="letter">
						<p id="option_letter66" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="67" class="letter">
						<p id="option_letter67" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="68" class="letter">
						<p id="option_letter68" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="69" class="letter">
						<p id="option_letter69" class="letter_display"></p>
					</div>
				</div>
				<div class="FL_choose">
					<div onclick=onClickedBox(this.id) id="70" class="letter">
						<p id="option_letter70" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="71" class="letter">
						<p id="option_letter71" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="72" class="letter">
						<p id="option_letter72" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="73" class="letter">
						<p id="option_letter73" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="74" class="letter">
						<p id="option_letter74" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="75" class="letter">
						<p id="option_letter75" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="76" class="letter">
						<p id="option_letter76" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="77" class="letter">
						<p id="option_letter77" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="78" class="letter">
						<p id="option_letter78" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="79" class="letter">
						<p id="option_letter79" class="letter_display"></p>
					</div>
				</div>
				<div class="FL_choose">
					<div onclick=onClickedBox(this.id) id="80" class="letter">
						<p id="option_letter80" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="81" class="letter">
						<p id="option_letter81" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="82" class="letter">
						<p id="option_letter82" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="83" class="letter">
						<p id="option_letter83" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="84" class="letter">
						<p id="option_letter84" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="85" class="letter">
						<p id="option_letter85" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="86" class="letter">
						<p id="option_letter86" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="87" class="letter">
						<p id="option_letter87" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="88" class="letter">
						<p id="option_letter88" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="89" class="letter">
						<p id="option_letter89" class="letter_display"></p>
					</div>
				</div>
				<div class="FL_choose">
					<div onclick=onClickedBox(this.id) id="90" class="letter">
						<p id="option_letter90" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="91" class="letter">
						<p id="option_letter91" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="92" class="letter">
						<p id="option_letter92" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="93" class="letter">
						<p id="option_letter93" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="94" class="letter">
						<p id="option_letter94" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="95" class="letter">
						<p id="option_letter95" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="96" class="letter">
						<p id="option_letter96" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="97" class="letter">
						<p id="option_letter97" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="98" class="letter">
						<p id="option_letter98" class="letter_display"></p>
					</div>
					<div onclick=onClickedBox(this.id) id="99" class="letter">
						<p id="option_letter99" class="letter_display"></p>
					</div>
				</div>
			</div>
		</div>
	</div>

<script>
var gamews = {};
var information = document.getElementById("Information");
var name_opponent = document.getElementById("name_opponent");
var name_player = document.getElementById("name_player");
var score_player = document.getElementById("score_player");
var score_opponent = document.getElementById("score_opponent");
var isClickable;
var turn = null;

window.onload = function(){
	createWebsocket();	
	isClickable = new Array(100).fill(true);
	
}

function createWebsocket(){
	var url = "ws://" + window.location.hostname + ":" + window.location.port + "/TySWeb_Practica/ws_games";
	gamews = new WebSocket(url);
	
	gamews.onopen = function(){
		beginMatch();
	}
	
	gamews.onerror = function(){}
	
	gamews.onclose = function(){}
	
	gamews.onmessage = function(m){
		var data = m.data;
		data = JSON.parse(data);
		
		if(data.TYPE == "MATCH"){
			if(data.currentPlayer == -1){
				information.innerHTML= "PARTIDA COMENZADA";
				name_player.innerHTML=sessionStorage.name;
				
				for (var i in data.players){
					if ((sessionStorage.name)!=(data.players[i].userName)){
						name_opponent.innerHTML= data.players[i].userName;
					}
				}
				fullfillBoard(data.board.board_state);
			}else{
				proveResult(data);
				modifyScore(data);
				checkPair(data);
			}

		}else if(data.TYPE == "INFORMATIVE"){
				information.innerHTML= data.text;
				name_player.innerHTML=sessionStorage.name;
				name_opponent.innerHTML= "...";
		}
	}
}

window.onbeforeunload = function(){
	sendQuit();
	gamews.close();
}

function sendQuit(){
	var p = {
			TYPE: "QUIT"
	}
	gamews.send(JSON.stringify(p));
}

function LeaveGame(){
	sendQuit();
	gamews.close();
	location.href="GameSelection.html";
}

function beginMatch(){
	var begin = {TYPE: "BEGIN_MATCH",
			GAME: "Find Letters."}
	gamews.send(JSON.stringify(begin));
}

function fullfillBoard(board_state){
	for(var x in board_state){
		var index = parseInt(x);
		var letter = document.getElementById("option_letter"+ index);
		letter.innerHTML = board_state[x];
	}
}
/* NNNNEENENENENENENNEE */
window.onbeforeunload = function(){
	gamews.close();
}

function EndGame(){
	gamews.close();
	location.href="EndScreen.html";	
}

function onClickedBox(clicked_id){
	if(isClickable[clicked_id] && tieneTurno()){
		var block_clicked = document.getElementById("option_letter"+clicked_id);
		block_clicked.setAttribute("style", "display:block");
	
		sendIfPossible(clicked_id);
	}
}

var options_to_send = new Array(2);

function sendIfPossible(index){
	var i;
	for(i=0; i<options_to_send.length; i++){
		if(options_to_send[i] == null){
			options_to_send[i] = index;
			isClickable[index] = false;
			break;
		}
	}
	if(options_to_send[options_to_send.length-1] != null){
		var p = {
				TYPE: "MOVEMENT",
				MOVE: [options_to_send[0], options_to_send[1]]
		}
		gamews.send(JSON.stringify(p));
		// Hide options
		var block1 = document.getElementById("option_letter"+options_to_send[0]);
		var block2 = document.getElementById("option_letter"+options_to_send[1]);
		block1.setAttribute("style", "display:none");
		block2.setAttribute("style", "display:none");
		/////
		isClickable[options_to_send[0]] = true;
		isClickable[options_to_send[1]] = true;
		options_to_send = new Array(2);
	}
	
}

function modifyScore(data){
	if(data.players[0].userName == sessionStorage.name){
		score_player.innerHTML = data.board.score0;
		score_opponent.innerHTML = data.board.score1;
	}else{
		score_player.innerHTML = data.board.score1;
		score_opponent.innerHTML = data.board.score0;
	}
}

function checkPair(data){
	if(data.board.pair[0] != -1 && data.board.pair[1] != -1){
		var block1 = document.getElementById("option_letter"+data.board.pair[0]);
		block1.setAttribute("style", "display:block");
		var block2 = document.getElementById("option_letter"+data.board.pair[1]);
		block2.setAttribute("style", "display:block");
		isClickable[data.board.pair[0]] = false;
		isClickable[data.board.pair[1]] = false;
	}else{
		isClickable[data.board.pair[0]] = true;
		isClickable[data.board.pair[1]] = true;
	}
}

function proveResult(data){
	if(data.winner == null){
		turn = data.players[data.currentPlayer].userName;
		information.innerHTML= "TURNO DE " + turn;
	}else{
		sessionStorage.winner = data.winner.userName;
    	EndGame();
	}
}

function tieneTurno(){
	if(turn == sessionStorage.name || turn == null)
		return true;
	else
		return false;
}


</script>
	
	

</body>
</html>